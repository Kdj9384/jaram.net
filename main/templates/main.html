{% extends 'layout.html' %}

{% load staticfiles %}
{% load board_extras %}

{% block header_title %}
  중요 알림
{% endblock %}

{% block header_content %}
  알림 내용
{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{% static 'mainapp/css/main.css' %}"/>
{% endblock %}

{% block body %}
  <div class="ui stackable two column divided grid container">
    <div class="row">
      <!--게시글 목록-->
      <div class="ten wide column">
        <!--최신 게시글-->
        <h1 class="ui header">최신 게시물</h1>
        <div class="ui divider"></div>
        <div class="ui divided items">
          {% for item in recent_posts %}
            <div class="item">
              <div class="ui small rounded image">
                {% if item.thumbnail %}
                  <a href="{% url 'post_detail' name=item.board.eng_name id=item.pk %}">
                    <img src="{{ item.thumbnail.url }}" style="width:150px; height:150px;">
                  </a>
                {% else %}
                  <a href="{% url 'post_detail' name=item.board.eng_name id=item.pk %}">
                    <img src="{% static 'mainapp/img/no_image.png' %}" style="width:150px; height:150px;">
                  </a>
                {% endif %}
              </div>
              <div class="content">
                <a href="{% url 'post_detail' name=item.board.eng_name id=item.pk %}"
                   class="header">{{ item.title }}</a>
                <div class="meta">
                  <span>{% autoescape off %}{{ item.content|get_text|truncatechars:150 }}{% endautoescape %}</span>
                </div>
                <div class="extra">
                  <div class="ui right floated small breadcrumb">
                    <a href="{% url 'post_list' name=item.board.eng_name %}" class="section">{{ item.board.name }}</a>
                  </div>
                  <span class="writer">{{ item.writer }}</span>
                  <span class="textDivider">|</span>
                  <span class="posted_date">{{ item.write_date }}</span>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
        <!--공지사항-->
        <h1 class="ui header">공지사항</h1>
        <div class="ui divider"></div>
        <div class="ui divided items">
          {% for item in notice_posts %}
            <div class="item">
              <div class="ui small rounded image">
                 <a href="{% url 'post_detail' name='notice' id=item.pk %}">
                   <img src="{% static 'mainapp/img/no_image.png' %}" style="width:150px; height:150px;">
                 </a>
              </div>
              <div class="content">
                {% if item.emphasis %}
                  <a href="{% url 'post_detail' name='notice' id=item.pk %}" class="header">중요 : {{ item.title }}</a>
                  <!-- TODO: '중요 : ' 이거 대신에 스타일을 다르게 주도록 변경-->
                {% else %}
                  <a href="{% url 'post_detail' name='notice' id=item.pk %}" class="header">{{ item.title }}</a>
                {% endif %}
                <div class="meta">
                  <span>{% autoescape off %}{{ item.content }}{% endautoescape %}</span>
                </div>
                <div class="extra">
                  {{ item.write_date }}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
      <!--우측 위젯 바-->
      <div class="six wide column">
        <div class="ui segment">
          <h1>Upcoming Events</h1>
          <div class="ui divider"></div>
          {% for weeks in new_calendar %}
          <tr>
            {% for date in weeks %}
              {% if date > 0 %}
                  <td style="height: 120px; background-color: #f7f7f7; padding: 0">
                    <div class="container">
                      <div class="contents">
                        {% for event in events %}
                          {% if event.start_date.month == today.month and event.start_date.day <= date %}
                            {% if event.end_date.day >= date or event.end_date.month != today.month %}
                                <p>{{ today.year }}/{{ today.month }}/{{ date }}</p>
                              <div class="schedule">
                              <ul>
                                <li><a href="{% url 'scheduleDetail' id=event.pk %}" class="title">{{ event.title }}</a></li>
                              </ul>
                              </div>
                            {% endif %}
                          {% endif %}
                        {% endfor %}
                      </div>
                    </div>
                  </td>
              {% endif %}
            {% endfor %}
          </tr>
          {% endfor %}
          {% for weeks in next_month_calendar %}
          <tr>
            {% for date in weeks %}
              {% if date > 0 %}
                  <td style="height: 120px; background-color: #f7f7f7; padding: 0">
                    <div class="container">
                      <div class="contents">
                        {% for event in events %}
                          {% if event.end_date.month > today.month and event.end_date.day >= date %}
                            {% if event.start_date.day <= date or event.start_date.month == today.month %}
                                <p>{{ today.year }}/{{ next_month }}/{{ date }}</p>
                              <div class="schedule">
                              <ul>
                                <li><a href="{% url 'scheduleDetail' id=event.pk %}" class="title">{{ event.title }}</a></li>
                              </ul>
                              </div>
                            {% endif %}
                          {% endif %}
                        {% endfor %}
                      </div>
                    </div>
                  </td>
              {% endif %}
            {% endfor %}
          </tr>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}